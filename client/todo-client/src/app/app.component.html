<mat-toolbar class="topbar" color="transparent">
  <div class="container header">
    <div class="brand">
      <mat-icon class="brand-icon" aria-hidden="true">checklist</mat-icon>
      <span class="brand-title">{{ title }}</span>
    </div>

    <span class="spacer"></span>

    <button mat-stroked-button class="btn-sm" (click)="refresh()" [disabled]="loading">
      <mat-icon>refresh</mat-icon>
      Refresh
    </button>
  </div>
</mat-toolbar>

<div class="container page">
  <mat-card class="card">
    <form class="form-row" [formGroup]="form" (ngSubmit)="add()">
      <mat-form-field appearance="outline" class="field field-title">
        <mat-label>Title</mat-label>
        <input matInput formControlName="title" placeholder="e.g. Call vendor" />
        <mat-error *ngIf="form.get('title')?.touched && form.get('title')?.invalid">
          Title is required.
        </mat-error>
      </mat-form-field>

      <mat-form-field appearance="outline" class="field field-priority">
        <mat-label>Priority</mat-label>
        <mat-select formControlName="priority">
          <mat-option *ngFor="let p of priorities" [value]="p.value">
            {{ p.label }}
          </mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field appearance="outline" class="field field-due">
        <mat-label>Due date</mat-label>
        <input matInput [matDatepicker]="picker" formControlName="dueAt" />
        <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
        <mat-datepicker #picker></mat-datepicker>
        <mat-error *ngIf="form.get('dueAt')?.touched && form.get('dueAt')?.invalid">
          Due date is required.
        </mat-error>
      </mat-form-field>

      <button mat-flat-button color="primary" class="btn-sm btn-add" type="submit" [disabled]="loading">
        <mat-icon>add</mat-icon>
        Add
      </button>
    </form>
  </mat-card>

  <mat-card class="card">
    <div class="status" *ngIf="loading">
      <mat-spinner diameter="22"></mat-spinner>
      <span>Loadingâ€¦</span>
    </div>

    <div class="error" *ngIf="!loading && errorMessage">
      {{ errorMessage }}
    </div>

    <div class="empty" *ngIf="!loading && !errorMessage && todos.length === 0">
      No todos yet.
    </div>

    <div class="table-wrap" *ngIf="!loading && !errorMessage && todos.length > 0">
      <table mat-table [dataSource]="todos" class="mat-elevation-z0">

        <!-- Done -->
        <ng-container matColumnDef="done">
          <th mat-header-cell *matHeaderCellDef>Done</th>
          <td mat-cell *matCellDef="let todo">
            <mat-checkbox [checked]="todo.isCompleted" (change)="toggle(todo)"></mat-checkbox>
          </td>
        </ng-container>

        <!-- Title -->
        <ng-container matColumnDef="title">
          <th mat-header-cell *matHeaderCellDef>Title</th>
          <td mat-cell *matCellDef="let todo">
            <span [class.done]="todo.isCompleted">{{ todo.title }}</span>
          </td>
        </ng-container>

        <!-- Priority -->
        <ng-container matColumnDef="priority">
          <th mat-header-cell *matHeaderCellDef>Priority</th>
          <td mat-cell *matCellDef="let todo">
            <span class="chip" [ngClass]="priorityChipClass(todo.priority)">
              {{ priorityLabel(todo.priority) }}
            </span>
          </td>
        </ng-container>

        <!-- Due -->
        <ng-container matColumnDef="due">
          <th mat-header-cell *matHeaderCellDef>Due</th>
          <td mat-cell *matCellDef="let todo">
            {{ todo.dueAt | date:'d MMM yyyy' }}
          </td>
        </ng-container>

        <!-- Created -->
        <ng-container matColumnDef="created">
          <th mat-header-cell *matHeaderCellDef>Created</th>
          <td mat-cell *matCellDef="let todo">
            {{ todo.createdAt | date:'d MMM yyyy' }}
          </td>
        </ng-container>

        <!-- Actions -->
        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef class="col-actions">Actions</th>
          <td mat-cell *matCellDef="let todo" class="col-actions">
            <button mat-icon-button class="icon-btn" (click)="confirmDelete(todo)" aria-label="Delete">
              <mat-icon>delete</mat-icon>
            </button>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
      </table>
    </div>
  </mat-card>
</div>
